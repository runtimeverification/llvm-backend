#!/bin/bash
set -e

if [ $# -lt 2 ]; then
  echo "Usage: $0 <definition.kore> [main|library|search|static|python|pythonast|c] <clang flags>"
  echo "See llvm-kompile -h for help"
  exit 1
fi
dt_dir="$(mktemp -d)"
trap 'rm -rf "$dt_dir"' INT TERM EXIT
definition=$(realpath "$1")
mode="$2"
shift; shift
( cd "@PROJECT_SOURCE_DIR@"/matching && mvn exec:java -Dexec.args="$definition qbaL $dt_dir 1" -q )
llvm-kompile "$definition" "$dt_dir" "$mode" -- "$@" -g
