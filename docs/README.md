# LLVM Backend

The [K Framework][k] LLVM backend implements **fast concrete execution** for
languages written in K. It does so by compiling K definitions to specialized,
native-code interpreters via [LLVM IR][llvm-ir]. This document is intended as a
technical reference for developers of the LLVM backend, rather than for end
users of K. If you are a K user looking for technical advice, please [open an
issue on the main K repository][issues].

## Contents

The LLVM backend documentation is split into two main sections: technical
documentation for the internal implementation details of the backend, and a
developer guide with best practices and conventions for working on the
repository.

* [Technical documentation][tech-docs]
* [Developer guide][dev-guide]

An incomplete, high-level overview of the backend's main structure and features
is given in the remainder of this document. Full details are given in the
[technical documentation][tech-docs].

## Overview

The backend does not operate on K definitions directly. Rather, it operates on
KORE, a de-sugared, simplified internal representation of K with a formal basis
in Matching Logic. A KORE definition can be compiled into a native interpreter
binary that efficiently implements the rewrite system specified by that
definition; these interpreters transform KORE terms into other KORE terms by
rewriting.

### Compilation

The backend performs compilation in two main steps. First, the set of rewrite
rules in the definition are used to generate a [decision tree
structure][maranget]; these trees describe an efficient way to destructure a
KORE term to determine whether a rewrite rule applies to it. Full details of
this procedure are given [here][matching].

Then, information from the definition and the compiled decision trees are used
to emit LLVM IR that implements an interpreter for the definition's rewrite
system.

![Flow diagram of LLVM backend interpreter compilation](images/compilation.svg#gh-light-mode-only)
![Flow diagram of LLVM backend interpreter compilation](images/compilation-dark.svg#gh-dark-mode-only)

### Execution

The interpreters generated by the backend load a KORE term as input, then parse
it to generate a space-efficient internal term structure. Rewrite rules are
applied to the term until no more can apply (i.e. rewriting finishes), and the
result is un-parsed to a KORE term for output.

![Flow diagram of LLVM backend execution](images/execution.svg#gh-light-mode-only)
![Flow diagram of LLVM backend execution](images/execution-dark.svg#gh-dark-mode-only)

[dev-guide]: developer-guide.md
[issues]: https://github.com/runtimeverification/k/issues
[k]: https://github.com/runtimeverification/k
[llvm-ir]: https://llvm.org/docs/LangRef.html
[maranget]: https://dl.acm.org/doi/10.1145/1411304.1411311
[matching]: ../matching/README.md
[tech-docs]: technical-documentation.md
